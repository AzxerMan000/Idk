-- GuiLibrary.lua

local GuiLibrary = {}
GuiLibrary.__index = GuiLibrary

function GuiLibrary.new()
    local self = setmetatable({}, GuiLibrary)
    return self
end

function GuiLibrary:createWindow(title, iconId)
    local player = game:GetService("Players").LocalPlayer
    local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    screenGui.Name = "GuiLibrary"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local iconButton = Instance.new("ImageButton", screenGui)
    iconButton.Name = "OpenIcon"
    iconButton.Size = UDim2.new(0, 40, 0, 40)
    iconButton.Position = UDim2.new(0, 10, 1, -50)
    iconButton.BackgroundTransparency = 1
    iconButton.Image = iconId or "rbxassetid://6031091002"
    iconButton.Visible = false

    local mainFrame = Instance.new("Frame", screenGui)
    mainFrame.Size = UDim2.new(0, 500, 0, 350)
    mainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    mainFrame.Draggable = true
    mainFrame.Active = true
    mainFrame.Name = "MainFrame"

    local topBar = Instance.new("Frame", mainFrame)
    topBar.Size = UDim2.new(1, 0, 0, 30)
    topBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    topBar.Name = "TopBar"

    local titleLabel = Instance.new("TextLabel", topBar)
    titleLabel.Size = UDim2.new(1, -60, 1, 0)
    titleLabel.Position = UDim2.new(0, 5, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title or "Window"
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.Font = Enum.Font.SourceSansBold
    titleLabel.TextSize = 20
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left

    -- Minimize Button
    local minimizeButton = Instance.new("TextButton", topBar)
    minimizeButton.Size = UDim2.new(0, 25, 1, 0)
    minimizeButton.Position = UDim2.new(1, -55, 0, 0)
    minimizeButton.Text = "_"
    minimizeButton.Font = Enum.Font.SourceSansBold
    minimizeButton.TextSize = 20
    minimizeButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    minimizeButton.TextColor3 = Color3.new(1, 1, 1)

    -- Close Button
    local closeButton = Instance.new("TextButton", topBar)
    closeButton.Size = UDim2.new(0, 25, 1, 0)
    closeButton.Position = UDim2.new(1, -30, 0, 0)
    closeButton.Text = "X"
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.TextSize = 20
    closeButton.BackgroundColor3 = Color3.fromRGB(45, 0, 0)
    closeButton.TextColor3 = Color3.new(1, 1, 1)

    local contentFrame = Instance.new("Frame", mainFrame)
    contentFrame.Size = UDim2.new(1, 0, 1, -30)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)

    -- Close
    closeButton.MouseButton1Click:Connect(function()
        mainFrame.Visible = false
        iconButton.Visible = true
    end)

    -- Minimize
    minimizeButton.MouseButton1Click:Connect(function()
        contentFrame.Visible = not contentFrame.Visible
    end)

    -- Icon reopen
    iconButton.MouseButton1Click:Connect(function()
        mainFrame.Visible = true
        iconButton.Visible = false
    end)

    local Window = {}
    Window.Tabs = {}
    Window.Frame = contentFrame

    function Window:createTab(tabName)
        local tabButton = Instance.new("TextButton", contentFrame)
        tabButton.Size = UDim2.new(0, 100, 0, 25)
        tabButton.Position = UDim2.new(0, #Window.Tabs * 105, 0, 0)
        tabButton.Text = tabName
        tabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        tabButton.TextColor3 = Color3.new(1, 1, 1)

        local tabFrame = Instance.new("Frame", contentFrame)
        tabFrame.Size = UDim2.new(1, 0, 1, -30)
        tabFrame.Position = UDim2.new(0, 0, 0, 30)
        tabFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
        tabFrame.Visible = false

        tabButton.MouseButton1Click:Connect(function()
            for _, t in pairs(Window.Tabs) do
                t.Frame.Visible = false
            end
            tabFrame.Visible = true
        end)

        local Tab = {}
        Tab.Frame = tabFrame

        function Tab:createButton(text, callback)
            local button = Instance.new("TextButton", tabFrame)
            button.Size = UDim2.new(0, 200, 0, 40)
            button.Position = UDim2.new(0, 10, 0, #tabFrame:GetChildren() * 45)
            button.Text = text
            button.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
            button.TextColor3 = Color3.new(1, 1, 1)
            button.Font = Enum.Font.SourceSans
            button.TextSize = 18

            button.MouseButton1Click:Connect(function()
                if callback then callback() end
            end)
        end

        table.insert(Window.Tabs, { Button = tabButton, Frame = tabFrame })
        return Tab
    end

    return Window
end

return GuiLibrary
